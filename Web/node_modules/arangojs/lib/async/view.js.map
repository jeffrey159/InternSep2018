{"version":3,"file":"view.js","sourceRoot":"","sources":["../../src/view.ts"],"names":[],"mappings":"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","sourcesContent":["import { Connection } from \"./connection\";\nimport { isArangoError } from \"./error\";\n\nexport enum ViewType {\n  ARANGOSEARCH_VIEW = \"arangosearch\"\n}\n\nexport interface ArangoView {\n  isArangoView: true;\n  name: string;\n}\n\nexport interface ArangoViewResponse {\n  name: string;\n  id: string;\n  type: ViewType;\n}\n\ninterface ArangoSearchConsolidate {\n  threshold: number;\n  segmentThreshold: number;\n}\n\ninterface ArangoSearchCollectionLink {\n  analyzers?: string[];\n  fields?: { [key: string]: ArangoSearchCollectionLink | undefined };\n  includeAllFields?: boolean;\n  trackListPositions?: boolean;\n  storeValues?: \"none\" | \"id\";\n}\n\nexport interface ArangoSearchProperties {\n  locale: string;\n  commit: {\n    consolidate: {\n      count?: ArangoSearchConsolidate;\n      bytes?: ArangoSearchConsolidate;\n      bytes_accum?: ArangoSearchConsolidate;\n      fill?: ArangoSearchConsolidate;\n    };\n    commitIntervalMsec?: number;\n    cleanupIntervalStep?: number;\n  };\n  links: {\n    [key: string]: ArangoSearchCollectionLink | undefined;\n  };\n}\n\nexport interface ArangoSearchPropertiesResponse\n  extends ArangoSearchProperties,\n    ArangoViewResponse {\n  type: ViewType.ARANGOSEARCH_VIEW;\n}\n\nexport interface ArangoSearchPropertiesOptions {\n  locale?: string;\n  commit?: {\n    consolidate?:\n      | \"none\"\n      | {\n          count?: Partial<ArangoSearchConsolidate>;\n          bytes?: Partial<ArangoSearchConsolidate>;\n          bytes_accum?: Partial<ArangoSearchConsolidate>;\n          fill?: Partial<ArangoSearchConsolidate>;\n        };\n    commitIntervalMsec?: number;\n    cleanupIntervalStep?: number;\n  };\n  links?: {\n    [key: string]: ArangoSearchCollectionLink | undefined;\n  };\n}\n\nconst VIEW_NOT_FOUND = 1203;\nexport abstract class BaseView implements ArangoView {\n  isArangoView: true = true;\n  name: string;\n  abstract type: ViewType;\n  protected _connection: Connection;\n\n  constructor(connection: Connection, name: string) {\n    this.name = name;\n    this._connection = connection;\n  }\n\n  get(): Promise<ArangoViewResponse> {\n    return this._connection.request(\n      { path: `/_api/view/${this.name}` },\n      res => res.body\n    );\n  }\n\n  exists() {\n    return this.get().then(\n      () => true,\n      err => {\n        if (isArangoError(err) && err.errorNum === VIEW_NOT_FOUND) {\n          return false;\n        }\n        throw err;\n      }\n    );\n  }\n\n  async rename(name: string) {\n    const result = await this._connection.request(\n      {\n        method: \"PUT\",\n        path: `/_api/view/${this.name}/rename`,\n        body: { name }\n      },\n      res => res.body\n    );\n    this.name = name;\n    return result;\n  }\n\n  drop() {\n    return this._connection.request(\n      {\n        method: \"DELETE\",\n        path: `/_api/view/${this.name}`\n      },\n      res => res.body\n    );\n  }\n}\n\nexport class ArangoSearchView extends BaseView {\n  type = ViewType.ARANGOSEARCH_VIEW;\n\n  create(\n    properties: ArangoSearchPropertiesOptions = {}\n  ): Promise<ArangoSearchPropertiesResponse> {\n    return this._connection.request(\n      {\n        method: \"POST\",\n        path: \"/_api/view\",\n        body: {\n          properties,\n          name: this.name,\n          type: this.type\n        }\n      },\n      res => res.body\n    );\n  }\n\n  properties(): Promise<ArangoSearchPropertiesResponse> {\n    return this._connection.request(\n      { path: `/_api/view/${this.name}/properties` },\n      res => res.body\n    );\n  }\n\n  setProperties(\n    properties: ArangoSearchPropertiesOptions = {}\n  ): Promise<ArangoSearchPropertiesResponse> {\n    return this._connection.request(\n      {\n        method: \"PATCH\",\n        path: `/_api/view/${this.name}/properties`,\n        body: properties\n      },\n      res => res.body\n    );\n  }\n\n  replaceProperties(\n    properties: ArangoSearchPropertiesOptions = {}\n  ): Promise<ArangoSearchPropertiesResponse> {\n    return this._connection.request(\n      {\n        method: \"PUT\",\n        path: `/_api/view/${this.name}/properties`,\n        body: properties\n      },\n      res => res.body\n    );\n  }\n}\n\nexport function constructView(connection: Connection, data: any): ArangoView {\n  if (data.type && data.type !== ViewType.ARANGOSEARCH_VIEW) {\n    throw new Error(`Unknown view type \"${data.type}\"`);\n  }\n  return new ArangoSearchView(connection, data.name);\n}\n"]}